<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.16" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Noticia+Text:400,700|Marcellus+SC'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <link rel="stylesheet" href="http://qingyunha.github.io/hugo/css/styles.css">
    <link rel="stylesheet" href="http://qingyunha.github.io/hugo/css/custom.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://qingyunha.github.io/hugo/index.xml">

    
    <title>Template Engine - Qing Yun</title>
    <meta property='og:title' content="Template Engine - Qing Yun">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="http://qingyunha.github.io/hugo/tags/template-engine/">
    
    


</head>

<body>

  <header class="l-header">
    <div class="p-logo">
      <a href="http://qingyunha.github.io/hugo/">Qing Yun</a>
    </div>
  </header>



<div class="container">
  <div class="row">
    <div class="col-md-9">

      <h1 class="p-page-title">Template Engine</h1>

      <div class="row">
        
        <div class="col-sm-4">
          <article class="grid">
  <a href="http://qingyunha.github.io/hugo/translation/a-template-engine/">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Fri, Oct 9, 2015</time>
      </div>
      <h2 class="title">A Template Engine</h2>
      <div class="summary">Introduction 大多数程序包含大量的逻辑和点点文本数据，编程语言被设计成适合做这样的 事情。但是有些编程任务只需要点点逻辑和大量的文本数据，对于这样的任务， 我们希望有一个更合适工具来做。模板引擎就是这样一个工具。在这一章，我 们会开发一个简单的模板引擎。 一个最常见的需要处理多文本数据的例子是web应用。web应用的一个重要部分 是为浏览器生成HTML网页。很少网页是完全静态的，它们至少包含一些动态数 据，比如用户名。一般情况下，网页有很大一部分动态数据：产品列表，好友消息更 新等等。 同时，每个HTML网页包含大量的静态文本。并且这些网页很大，有成千上万个 字节。这时，web开发者就有一个问题要解决：怎样才能最有效的生成同时包 含静态和动态数据的长字符串？随之而来的问题，这些静态文本其实是前端工 程师写的HTML，他们想希望用自己熟悉的方法处理这些HTML。 为了说明，让我们假设想生成这样一个简单的HTML &lt;p&gt;Welcome, Charlie!&lt;/p&gt; &lt;p&gt;Products:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;Apple: $1.00&lt;/li&gt; &lt;li&gt;Fig: $1.50&lt;/li&gt; &lt;li&gt;Pomegranate: $3.25&lt;/li&gt; &lt;/ul&gt; 这里，用户名会是动态的，产品的名称和数量也是动态的，甚至产品的数量也 不是固定的：在其他情况，可能有更多或更少的产品。 一个简单的方法生成这样的网页是把这样的字符串作为常量写入我们的代码中， 然后把它们拼在一起完成这个网页。动态数据使用类似字符替换的方法插入进 去。有些动态数据是重复的，比如产品列表，这就是说我们会有一些重复的 HTML段，所以我们要单独的去处理它们再和其他的HTML合并起来。 使用这种方法生成我们的HTML的代码会像这样 # The main HTML for the whole page. PAGE_HTML = &quot;&quot;&quot; &lt;p&gt;Welcome, {name}!&lt;/p&gt; &lt;p&gt;Products:&lt;/p&gt; &lt;ul&gt; {products} &lt;/ul&gt; &quot;&quot;&quot; # The HTML for each product displayed. PRODUCT_HTML = &quot;&lt;li&gt;{prodname}: {price}&lt;/li&gt;\n&quot; def make_page(username, products): product_html = &quot;&quot; for prodname, price in products: product_html += PRODUCT_HTML.format(prodname=prodname, price=format_price(price)) html = PAGE_HTML.format(name=username, products=product_html) return html 这样可以，但是我们搞得乱七八糟，HTML成了我们代码里的字符串常量，我们 很难看出这个HTML的结构，因为它被分成一段一段的了。数据格式的细节迷失 在python代码中。并且，为了修改HTML，我们的前端工程师需要修改python代 码。想象一下，如果这个网页比现在这个复杂10倍（或者100倍）我们代码会 是什么样子。 Templates 更好的方法是用模板来生成HTML，或者说把HTML写成一个模板，这样绝大部分 就是静态HTML，再加上一点使用特别符号的动态内容。现在我们的toy网页就成了 下面这样的模板 &lt;p&gt;Welcome, {{user_name}}!&lt;/p&gt; &lt;p&gt;Products:&lt;/p&gt; &lt;ul&gt; {% for product in product_list %} &lt;li&gt;{{ product.name }}: {{ product.price|format_price }}&lt;/li&gt; {% endfor %} &lt;/ul&gt; 这里我们关注的是HTML文本，另外加上一点逻辑。对比现在以文本为中心的方 法和之前以逻辑为中心的方法，我们之前的程序大部分是python代码，这里我 的程序大部分是静态的HTML标签。 在模板中采用的以静态为主的风格和大多数编程语言的工作方式相反。比如 python，几乎所有的源文件都是可执行代码，如果你需要静态文本，你就要把 它嵌到字符串中。 def hello(): print(&quot;Hello world!&quot;) hello() 当python读取这个源文件时，它把def hello():这样的文本解释成要被执行 的指令，而在双引号中的字符 print(&quot;Hello, world!&quot;)被指示成文本。这 就是编程语言如何工作的：动态的，嵌入点点静态内容。静态的内容通过双引号来指示。 一个模板语言把这个过程反过来了，大部分是静态文本，用特殊的符号指示动态 内容。 &lt;p&gt;Welcome, {{user_name}}!&lt;/p&gt; 这里的文本会直接出现在最终的HTML中，直到遇到 {{ 符号，它指示转换到 动态模式，这里user_name变量就会被替换。 字符串格式化函数，比如python的 &quot;foo = {foo}!&quot;.format(foo=17)就是一 个在字符串并插入数据创建文本的微型语言的例子。模板更进一步，加上逻辑结构，比如条件，循环。这只是在程度上不同。 把这些文件叫做模板是因为它们被用来生成大量结构相似的网页，只是细节不同。 为了在程序中使用HTML模板，我们需要一个模板引擎(template engine)：一个需要两个参数的函数，一个是描述页面结构和内容的静态模板，另一个是包含要插入到模板中的动态数据的上下文。模板引擎把模板和上下文结合起来生成完整的HTML字符串，它的任务是解释模板，用真正的数据替换动态的部分。 顺便说一下，HTML对模板引擎并没有什么特别的地方，它可以用来生成任何文本数据。比如，它可以被用来生成纯文本的email信息。但是它通常用于HTML，或许碰巧还有些专门对HTML的特性，比如转义，这个特性让你不用担心插入了对HTML有特殊含义的字符。 Supported Syntax 不同的模板引擎在语法支持上各有不同。我们的模板语法基于Django，一个非常流行的网站框架。因为我们的引擎使用python实现的，一些python的概念会出现在我们的语法中。在上一节的HTML中我们已经看到了一些语法，这里是我们语法的小总结。 上下文中的数据插入到两个大括号中 &lt;p&gt;Welcome, {{user_name}}!&lt;/p&gt; 在模板中可用的数据在上下文中，后面我们详细的讲到。 我们的模板引擎提供了一个简单自由的语法访问数据中的元素。在python中，这些表达式有不同的效果： dict[&quot;key&quot;] obj.attr obj.method() 在我们的语法中，所有这些操作都用点号表示。 dict.key obj.attr obj.method 这个点号会访问对象的属性，字典里的值，如果结果是可调用的，那么就自动调用它。这与python代码不同，你需要不同的语法完成不同的操作。在我们简单的语法下会是这样： &lt;p&gt;The price is: {{product.price}}, with a {{product.discount}}% discount.&lt;/p&gt; 点号可以在一个值上多次使用以访问元素链。 你还可以使用帮助函数，把它们叫做过滤器，用管道符号调用 &lt;p&gt;Short name: {{story.subject|slugify|lower}}&lt;/p&gt; 制作有趣的网页通常需要一点逻辑，所以我们有条件表达式： {% if user.is_logged_in %} &lt;p&gt;Welcome, {{ user.name }}!&lt;/p&gt; {% else %} &lt;p&gt;&lt;a href=&quot;/login&quot;&gt;Log in &lt;/a&gt;&lt;/p&gt; {% endif %} 循环可以让我们在网页里包含数据集合： &lt;p&gt;Products:&lt;/p&gt; &lt;ul&gt; {% for product in product_list %} &lt;li&gt;{{ product.name }}: {{ product.price|format_price }}&lt;/li&gt; {% endfor %} &lt;/ul&gt; 和其他的编程语言一样，条件和循环可以嵌套使用。 最后，我们可以对模板注释 {# This is the best template ever!</div>
    </footer>
  </a>
</article>

        </div>
        
      </div>

      


    </div>

    <div class="col-md-3">
      <aside class="site">

  

  

  <section>
    <header>LatestPosts</header>
    <div>
      
      <article class="li">
  <a href="http://qingyunha.github.io/hugo/blog/python-name/" class="clearfix">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Mon, Aug 22, 2016</time>
      </div>
      <h2 class="title">python值传递 or 引用传递</h2>
    </footer>
  </a>
</article>

      
      <article class="li">
  <a href="http://qingyunha.github.io/hugo/blog/read-memcached-1.2.0/" class="clearfix">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Thu, Aug 18, 2016</time>
      </div>
      <h2 class="title">memcached-1.2.0 源码解读</h2>
    </footer>
  </a>
</article>

      
      <article class="li">
  <a href="http://qingyunha.github.io/hugo/wiki/git-proxy/" class="clearfix">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Sat, Aug 6, 2016</time>
      </div>
      <h2 class="title">git proxy</h2>
    </footer>
  </a>
</article>

      
      <article class="li">
  <a href="http://qingyunha.github.io/hugo/blog/python-logging/" class="clearfix">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Sat, Jul 9, 2016</time>
      </div>
      <h2 class="title">python logging</h2>
    </footer>
  </a>
</article>

      
      <article class="li">
  <a href="http://qingyunha.github.io/hugo/translation/crawler/" class="clearfix">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Sat, Jul 9, 2016</time>
      </div>
      <h2 class="title">A Web Crawler With asyncio Coroutines</h2>
    </footer>
  </a>
</article>

      
      <article class="li">
  <a href="http://qingyunha.github.io/hugo/wiki/flask-dev/" class="clearfix">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Sat, May 21, 2016</time>
      </div>
      <h2 class="title">成为Flask贡献者</h2>
    </footer>
  </a>
</article>

      
      <article class="li">
  <a href="http://qingyunha.github.io/hugo/translation/python-interpreter/" class="clearfix">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Mon, May 9, 2016</time>
      </div>
      <h2 class="title">A Python Interpreter Written in Python</h2>
    </footer>
  </a>
</article>

      
      <article class="li">
  <a href="http://qingyunha.github.io/hugo/translation/a-template-engine/" class="clearfix">
    <div class="image" style="background-image: url(http://qingyunha.github.io/hugo/images/default.jpg);"></div>
    <footer>
      <div class="date">
        <time>Fri, Oct 9, 2015</time>
      </div>
      <h2 class="title">A Template Engine</h2>
    </footer>
  </a>
</article>

      
    </div>
  </section>

  
  <section>
    <header>category</header>
    <div>
      <ul>
        <li><a href="http://qingyunha.github.io/hugo/categories/blog">blog</a></li><li><a href="http://qingyunha.github.io/hugo/categories/translation">translation</a></li><li><a href="http://qingyunha.github.io/hugo/categories/wiki">wiki</a></li>
      </ul>
    </div>
  </section>
  
  <section>
    <header>tag</header>
    <div>
      <ul>
        <li><a href="http://qingyunha.github.io/hugo/tags/python">python</a></li><li><a href="http://qingyunha.github.io/hugo/tags/asyn">asyn</a></li><li><a href="http://qingyunha.github.io/hugo/tags/git">git</a></li><li><a href="http://qingyunha.github.io/hugo/tags/interpreter">interpreter</a></li><li><a href="http://qingyunha.github.io/hugo/tags/logging">logging</a></li><li><a href="http://qingyunha.github.io/hugo/tags/memcached">memcached</a></li><li><a href="http://qingyunha.github.io/hugo/tags/proxy">proxy</a></li><li><a href="http://qingyunha.github.io/hugo/tags/template-engine">template-engine</a></li><li><a href="http://qingyunha.github.io/hugo/tags/virtual-machine">virtual-machine</a></li>
      </ul>
    </div>
  </section>
  

</aside>

    </div>

  </div>

</div>


<footer class="l-footer">
  <p>&copy; 2016 Qing Yun</p>
  <p>Powered by <a href="http://gohugo.io" target="_blank" rel="nofollow">Hugo</a>, Theme <a href="https://github.com/dim0627/hugo_theme_robust" target="_blank" rel="nofollow">robust</a> designed by <a href="http://yet.unresolved.xyz" target="_blank" rel="nofollow">Daisuke Tsuji</a></p>
</footer>

<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



  </body>
</html>


